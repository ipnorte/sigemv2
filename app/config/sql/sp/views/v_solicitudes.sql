/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 * Author:  adrian
 * Created: 17/05/2019
 */

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ipnorte_m22s`.`v_solicitudes` AS select `MutualProductoSolicitud`.`id` AS `numero_solicitud`,`MutualProductoSolicitud`.`permanente` AS `permanente`,`MutualProductoSolicitud`.`estado` AS `estado`,`Estado`.`concepto_1` AS `estado_descripcion`,`MutualProductoSolicitud`.`fecha` AS `fecha_emision`,`MutualProductoSolicitud`.`fecha_pago` AS `fecha_pago`,`MutualProductoSolicitud`.`aprobada` AS `aprobada`,`MutualProductoSolicitud`.`periodo_ini` AS `periodo_inicio`,`MutualProductoSolicitud`.`tipo_orden_dto` AS `tipo_orden_dto`,`MutualProductoSolicitud`.`tipo_producto` AS `tipo_producto`,`Producto`.`concepto_1` AS `tipo_producto_concepto`,`MutualProductoSolicitud`.`proveedor_id` AS `proveedor_id`,`ProveedorOrigen`.`razon_social` AS `proveedor_origen_razon_social`,`MutualProductoSolicitud`.`reasignar_proveedor_id` AS `proveedor_reasigna_id`,`ProveedorReasigna`.`razon_social` AS `proveedor_reasigna_razon_social`,`MutualProductoSolicitud`.`reasignar_proveedor_fecha` AS `reasignar_proveedor_fecha`,`MutualProductoSolicitud`.`reasignar_proveedor_usuario` AS `reasignar_proveedor_usuario`,ifnull(concat(`PersonaVendedor`.`apellido`,' ',`PersonaVendedor`.`nombre`),ifnull(`MutualProductoSolicitud`.`user_created`,'MUTUAL')) AS `vendedor`,ifnull(`MutualProductoSolicitud`.`user_created`,'MUTUAL') AS `usuario`,`MutualProductoSolicitud`.`importe_solicitado` AS `importe_solicitado`,`MutualProductoSolicitud`.`importe_percibido` AS `importe_percibido`,`MutualProductoSolicitud`.`cuotas` AS `cuotas`,`MutualProductoSolicitud`.`importe_cuota` AS `importe_cuota`,`MutualProductoSolicitud`.`importe_total` AS `importe_total`,`MutualProductoSolicitud`.`socio_id` AS `socio_id`,`MutualProductoSolicitud`.`persona_id` AS `persona_id`,`Persona`.`documento` AS `documento`,concat(`Persona`.`apellido`,', ',`Persona`.`nombre`) AS `solicitante`,`PersonaBeneficio`.`codigo_beneficio` AS `codigo_organismo`,`Organismo`.`concepto_1` AS `codigo_organismo_concepto`,`PersonaBeneficio`.`codigo_empresa` AS `codigo_empresa`,`Empresa`.`concepto_1` AS `codigo_empresa_concepto`,`FX_SOLICITUD_GET_ORDENDTO`(`MutualProductoSolicitud`.`id`) AS `orden_descuento_id` from (((((((((((`ipnorte_m22s`.`mutual_producto_solicitudes` `MutualProductoSolicitud` join `ipnorte_m22s`.`personas` `Persona` on((`Persona`.`id` = `MutualProductoSolicitud`.`persona_id`))) join `ipnorte_m22s`.`persona_beneficios` `PersonaBeneficio` on((`PersonaBeneficio`.`id` = `MutualProductoSolicitud`.`persona_beneficio_id`))) join `ipnorte_m22s`.`global_datos` `Organismo` on((`Organismo`.`id` = `PersonaBeneficio`.`codigo_beneficio`))) join `ipnorte_m22s`.`global_datos` `Empresa` on((`Empresa`.`id` = `PersonaBeneficio`.`codigo_empresa`))) left join `ipnorte_m22s`.`socios` `Socio` on((`Socio`.`id` = `MutualProductoSolicitud`.`socio_id`))) join `ipnorte_m22s`.`global_datos` `Producto` on((`Producto`.`id` = `MutualProductoSolicitud`.`tipo_producto`))) join `ipnorte_m22s`.`global_datos` `Estado` on((`Estado`.`id` = `MutualProductoSolicitud`.`estado`))) join `ipnorte_m22s`.`proveedores` `ProveedorOrigen` on((`ProveedorOrigen`.`id` = `MutualProductoSolicitud`.`proveedor_id`))) left join `ipnorte_m22s`.`proveedores` `ProveedorReasigna` on((`ProveedorReasigna`.`id` = `MutualProductoSolicitud`.`reasignar_proveedor_id`))) left join `ipnorte_m22s`.`vendedores` `Vendedor` on((`Vendedor`.`id` = `MutualProductoSolicitud`.`vendedor_id`))) left join `ipnorte_m22s`.`personas` `PersonaVendedor` on((`PersonaVendedor`.`id` = `Vendedor`.`persona_id`))) where (`MutualProductoSolicitud`.`anulada` = 0);

